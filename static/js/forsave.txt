document.getElementById('uploadForm').addEventListener('submit', function(e) {
    e.preventDefault();
    var formData = new FormData(this);

    document.getElementById('feedback').innerText = 'Processing... Please wait.';

    fetch('/upload_and_track/', {
        method: 'POST',
        body: formData,
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('feedback').innerText = '';

        if (data.status === 'success') {
            var downloadsSection = document.getElementById('downloads');
            downloadsSection.innerHTML = `
                <a href="${data.videoUrl}" download>Download Annotated Video</a><br>
                <a href="${data.detailedResultsUrl}" download>Download Detailed Results</a><br>
                <a href="${data.summaryUrl}" download>Download Summary</a>
            `;
            // Optionally, clear the message if there was a previous error shown
            document.getElementById('errorFeedback').innerText = '';
        } else if (data.status === "No animals detected") {
            // Handle the case where no animals are detected specifically
            document.getElementById('errorFeedback').innerText = data.message;
            // Clear the downloads section in case there was a previous successful upload
            document.getElementById('downloads').innerHTML = '';
        } else {
            // Handle other errors generically
            document.getElementById('errorFeedback').innerText = 'An error occurred. Please try again.';
        }
    })
    .catch(error => {
        console.log("Error:", error); 
        document.getElementById('errorFeedback').innerText = 'An error occurred. Please try again.';
    });
});

